generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id          String                 @id @default(uuid()) @db.Char(36)
  nombre      String                 @db.VarChar(100)
  apellidos   String                 @db.VarChar(150)
  email       String                 @unique(map: "email") @db.VarChar(150)
  contrasena  String                 @db.VarChar(255)
  activo      Boolean?               @default(true)
  telefono    String?                @db.VarChar(20)
  id_rol      String?                @db.Char(36)
  foto        String?                @db.VarChar(500)
  favoritos   Favorito[]             @relation("ClienteFavoritos")
  propiedades Inmueble[]             @relation("PropietarioInmuebles")
  metricas    MetricaAdministrador[]
  rol         rol?                   @relation(fields: [id_rol], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "usuario_ibfk_1")

  @@index([id_rol], map: "id_rol")
  @@map("usuario")
}

model TipoInmueble {
  id        String     @id @default(uuid()) @db.Char(36)
  tipo      String     @db.VarChar(100)
  inmuebles Inmueble[]

  @@map("tipo_inmueble")
}

model Ubicacion {
  id        String     @id @default(uuid()) @db.Char(36)
  direccion String?    @db.VarChar(255)
  ciudad    String?    @db.VarChar(100)
  barrio    String?    @db.VarChar(100)
  latitud   Decimal?   @db.Decimal(10, 7)
  longitud  Decimal?   @db.Decimal(10, 7)
  inmuebles Inmueble[]

  @@map("ubicacion")
}

model Inmueble {
  id               String         @id @default(uuid()) @db.Char(36)
  titulo           String         @db.VarChar(150)
  descripcion      String?        @db.Text
  precio           Decimal?       @db.Decimal(15, 2)
  area_m2          Decimal?       @db.Decimal(10, 2)
  habitaciones     Int?
  banos            Int?
  activo           String?        @db.VarChar(500)
  id_propietario   String         @db.Char(36)
  id_tipo_inmueble String         @db.Char(36)
  id_ubicacion     String         @db.Char(36)
  favoritos        Favorito[]
  fotos            FotoInmueble[]
  propietario      Usuario        @relation("PropietarioInmuebles", fields: [id_propietario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "inmueble_ibfk_1")
  tipoInmueble     TipoInmueble   @relation(fields: [id_tipo_inmueble], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "inmueble_ibfk_2")
  ubicacion        Ubicacion      @relation(fields: [id_ubicacion], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "inmueble_ibfk_3")

  @@index([id_propietario], map: "id_propietario")
  @@index([id_tipo_inmueble], map: "id_tipo_inmueble")
  @@index([id_ubicacion], map: "id_ubicacion")
  @@map("inmueble")
}

model FotoInmueble {
  id          String   @id @default(uuid()) @db.Char(36)
  id_inmueble String   @db.Char(36)
  url         String   @db.VarChar(500)
  numero      Int?
  inmueble    Inmueble @relation(fields: [id_inmueble], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "foto_inmueble_ibfk_1")

  @@index([id_inmueble], map: "id_inmueble")
  @@map("foto_inmueble")
}

model Favorito {
  id          String   @id @default(uuid()) @db.Char(36)
  id_cliente  String   @db.Char(36)
  id_inmueble String   @db.Char(36)
  cliente     Usuario  @relation("ClienteFavoritos", fields: [id_cliente], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "favorito_ibfk_1")
  inmueble    Inmueble @relation(fields: [id_inmueble], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "favorito_ibfk_2")

  @@unique([id_cliente, id_inmueble], map: "id_cliente")
  @@index([id_inmueble], map: "id_inmueble")
  @@map("favorito")
}

model MetricaAdministrador {
  id                          String    @id @default(uuid()) @db.Char(36)
  numero_usuarios_activos     Int?      @default(0)
  numero_propiedades          Int?      @default(0)
  numero_propiedades_vendidas Int?      @default(0)
  fecha_creacion              DateTime? @default(now()) @db.DateTime(0)
  fecha_actualizacion         DateTime? @default(now()) @updatedAt @db.DateTime(0)
  id_usuario                  String    @db.Char(36)
  usuario                     Usuario   @relation(fields: [id_usuario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "metricas_administrador_ibfk_1")

  @@index([id_usuario], map: "id_usuario")
  @@map("metricas_administrador")
}

model rol {
  id       String    @id @db.Char(36)
  nombre   String    @unique(map: "nombre") @db.VarChar(100)
  usuarios Usuario[]
}
